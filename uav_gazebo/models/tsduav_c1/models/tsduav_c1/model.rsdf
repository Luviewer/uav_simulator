<?xml version="1.0" ?>
  <%

prop_dx = 0.61471
prop_dy = 0.725
prop_dz = -0.0465

prop_timeConstantUp = 0.0125
prop_timeConstantDown = 0.025
prop_maxRotVelocity = 1000
prop_motorConstant = 8.599e-5
prop_momentConstant = 0.25

prop_motors={
	"0" => {:jointName => "prop_0_joint", :linkName => "prop_0", :dir => "ccw", :x =>  prop_dx, :y => -prop_dy, :z => prop_dz},
	"1" => {:jointName => "prop_1_joint", :linkName => "prop_1", :dir => "cw",  :x =>  -prop_dx, :y =>  prop_dy, :z => prop_dz},
	"2" => {:jointName => "prop_2_joint", :linkName => "prop_2", :dir => "ccw", :x => prop_dx, :y =>  prop_dy, :z => prop_dz},
	"3" => {:jointName => "prop_3_joint", :linkName => "prop_3", :dir => "cw",  :x => -prop_dx, :y => -prop_dy, :z => prop_dz},
}
# "4" => {:jointName => "prop_4_joint", :linkName => "prop_4", :dir => "ccw", :x =>  prop_dx, :y =>  prop_dy, :z => -prop_dz-0.02},
#         "5" => {:jointName => "prop_5_joint", :linkName => "prop_5", :dir => "cw",  :x =>  prop_dx, :y => -prop_dy, :z => -prop_dz-0.02},
#         "6" => {:jointName => "prop_6_joint", :linkName => "prop_6", :dir => "ccw", :x => -prop_dx, :y => -prop_dy, :z => -prop_dz-0.02},
#         "7" => {:jointName => "prop_7_joint", :linkName => "prop_7", :dir => "cw",  :x => -prop_dx, :y =>  prop_dy, :z => -prop_dz-0.02},


link_base_dx = 0;
link_base_dy = 0;
link_base_dz = 0;

%>
  <sdf version="1.5">
    <model name="tsduav_c1">
      <%# ====================================================================================== %>
      <include>
        <uri>model://tsduav_c1_base</uri>
        <name>tsduav_c1_base</name>
        <pose>0 0 0.0 0 0 0</pose>
      </include>
      <%
			prop_motors.keys.each do |k|
				dir = prop_motors[k][:dir]
        dx = prop_motors[k][:x]
        dy = prop_motors[k][:y]
        dz = prop_motors[k][:z]
      %>
      <include>
        <uri>model://tsduav_c1_prop</uri>
        <name><%= "tsduav_c1_prop_" + k%></name>
        <pose><%= dx %> <%= dy %> <%= dz %> 0 0 0</pose>
      </include>
      <joint name=<%= '"' + 'tsduav_c1_prop_' + k + '_joint' + '"'%> type="revolute">
        <parent>tsduav_c1_base::base</parent>
        <child><%= 'tsduav_c1_prop_' + k + '::prop '%></child>
        <axis>
          <xyz>0 0 1</xyz>
          <limit>
            <lower>-1e+16</lower>
            <upper>1e+16</upper>
          </limit>
          <dynamics>
            <damping>0.00001</damping>
          </dynamics>
          <use_parent_model_frame>1</use_parent_model_frame>
        </axis>
      </joint>
      <plugin name=<%= '"tsduav_c1_prop_'+ k + '_plugin"' %> filename='librotors_gazebo_motor_model.so'>
        <robotNamespace></robotNamespace>
        <jointName><%= 'tsduav_c1_prop_' + k + '_joint' %> </jointName>
        <linkName><%= 'tsduav_c1_prop_' + k + '::prop'%></linkName>
        <turningDirection><%= dir %></turningDirection>
        <timeConstantUp><%= prop_timeConstantUp %></timeConstantUp>
        <timeConstantDown><%= prop_timeConstantDown %></timeConstantDown>
        <maxRotVelocity><%= prop_maxRotVelocity %></maxRotVelocity>
        <motorConstant><%= prop_motorConstant %></motorConstant>
        <momentConstant><%= prop_momentConstant %></momentConstant>
        <commandSubTopic>/gazebo/command/prop_speed</commandSubTopic>
        <motorNumber><%= k %></motorNumber>
        <rotorDragCoefficient>0.000806428</rotorDragCoefficient>
        <rollingMomentCoefficient>1e-06</rollingMomentCoefficient>
        <motorSpeedPubTopic><%= 'prop_speed/' + k %></motorSpeedPubTopic>
        <rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
      </plugin>
    <% end %>
    <%# ====================================================================================== %>
    <include>
      <uri>model://tsduav_c1_wheel</uri>
      <name>tsduav_c1_wheel_0</name>
      <pose>-0.0382 0.25 0.2185 0 0 0</pose>
    </include>
    <joint name="tsduav_c1_wheel_0_joint" type="revolute">
      <parent>tsduav_c1_base::base</parent>
      <child>tsduav_c1_wheel_0::wheel</child>
      <axis>
        <xyz>1 0 0</xyz>
        <limit>
          <lower>-1e+16</lower>
          <upper>1e+16</upper>
        </limit>
        <dynamics>
          <damping>0.00001</damping>
        </dynamics>
        <use_parent_model_frame>1</use_parent_model_frame>
      </axis>
    </joint>
    <plugin name="tsduav_c1_wheel_0_plugin" filename='librotors_gazebo_motor_model.so'>
      <robotNamespace></robotNamespace>
      <jointName>tsduav_c1_wheel_0_joint </jointName>
      <linkName>tsduav_c1_wheel_0::wheel</linkName>
      <turningDirection>cw</turningDirection>
      <timeConstantUp>0.0125</timeConstantUp>
      <timeConstantDown>0.025</timeConstantDown>
      <maxRotVelocity>1000</maxRotVelocity>
      <motorConstant>8.599e-05</motorConstant>
      <momentConstant>0.25</momentConstant>
      <commandSubTopic>/gazebo/command/wheel_speed</commandSubTopic>
      <motorNumber>0</motorNumber>
      <rotorDragCoefficient>0.000806428</rotorDragCoefficient>
      <rollingMomentCoefficient>1e-06</rollingMomentCoefficient>
      <motorSpeedPubTopic>wheel_speed/0</motorSpeedPubTopic>
      <rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
    </plugin>
    <include>
      <uri>model://tsduav_c1_wheel</uri>
      <name>tsduav_c1_wheel_1</name>
      <pose>0.0382 -0.25 0.2185 0 0 3.1415926535</pose>
    </include>
    <joint name="tsduav_c1_wheel_1_joint" type="revolute">
      <parent>tsduav_c1_base::base</parent>
      <child>tsduav_c1_wheel_1::wheel</child>
      <axis>
        <xyz>1 0 0</xyz>
        <limit>
          <lower>-1e+16</lower>
          <upper>1e+16</upper>
        </limit>
        <dynamics>
          <damping>0.00001</damping>
        </dynamics>
        <use_parent_model_frame>1</use_parent_model_frame>
      </axis>
    </joint>
    <plugin name="tsduav_c1_wheel_1_plugin" filename='librotors_gazebo_motor_model.so'>
      <robotNamespace></robotNamespace>
      <jointName>tsduav_c1_wheel_1_joint </jointName>
      <linkName>tsduav_c1_wheel_1::wheel</linkName>
      <turningDirection>cw</turningDirection>
      <timeConstantUp>0.0125</timeConstantUp>
      <timeConstantDown>0.025</timeConstantDown>
      <maxRotVelocity>1000</maxRotVelocity>
      <motorConstant>8.599e-05</motorConstant>
      <momentConstant>0.25</momentConstant>
      <commandSubTopic>/gazebo/command/wheel_speed</commandSubTopic>
      <motorNumber>1</motorNumber>
      <rotorDragCoefficient>0.000806428</rotorDragCoefficient>
      <rollingMomentCoefficient>1e-06</rollingMomentCoefficient>
      <motorSpeedPubTopic>wheel_speed/1</motorSpeedPubTopic>
      <rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
    </plugin>
    <plugin name="ArduRotorQuadOctPlugin" filename="libArduRotorQuadOctPlugin.so">
      <fdm_addr>127.0.0.1</fdm_addr>
      <fdm_port_in>9002</fdm_port_in>
      <fdm_port_out>9003</fdm_port_out>
      <modelXYZToAirplaneXForwardZDown>0 0 0 3.141593 0 0</modelXYZToAirplaneXForwardZDown>
      <gazeboXYZToNED>0 0 0 3.141593 0 0</gazeboXYZToNED>
      <motor_num>4</motor_num>
      <motor_pub>/gazebo/command/prop_speed</motor_pub>
      <imuName>tsduav_c1::tsduav_c1_base::imu_link::imu_sensor</imuName>
      <connectionTimeoutMaxCount>5</connectionTimeoutMaxCount>
    </plugin>
  </model>
</sdf>
